import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as i}from"./index.CRdpAhVf.js";function p({id:n}){const[r,d]=i.useState(null),[a,o]=i.useState("loading"),[s,c]=i.useState({anonymous:!0,name:"",message:""});i.useEffect(()=>{if(!n){console.warn("âš ï¸ Aucun ID fourni au composant VerifyAttestation");return}console.log("ğŸ“¡ VÃ©rification en cours pour l'ID :",n),fetch(`https://outdoor-arlene-ampbenin-4ca9a164.koyeb.app/api/certificates/verify/${n}`).then(t=>(console.log("ğŸ“¥ RÃ©ponse brute du serveur :",t),t.json())).then(t=>{console.log("ğŸ“¥ RÃ©ponse JSON dÃ©codÃ©e :",t),t.error?(console.error("âŒ Erreur renvoyÃ©e par le backend :",t.error),o("error")):(console.log("âœ… DonnÃ©es de lâ€™attestation :",t),d(t),o("showData"))}).catch(t=>{console.error("ğŸš¨ Erreur lors du fetch :",t),o("error")})},[n]);const m=async t=>{t.preventDefault(),console.log("ğŸ“¤ Envoi du rapport :",{attestationId:n,...s});try{const l=await fetch("/.netlify/functions/reportAttestation",{method:"POST",body:JSON.stringify({attestationId:n,...s}),headers:{"Content-Type":"application/json"}});if(console.log("ğŸ“¥ RÃ©ponse Ã  la dÃ©nonciation :",l),!l.ok)throw new Error("Erreur cÃ´tÃ© serveur");o("thanks")}catch(l){console.error("ğŸš¨ Erreur lors de l'envoi de la dÃ©nonciation :",l),alert("Erreur lors de l'envoi, veuillez rÃ©essayer.")}};return a==="loading"?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("p",{className:"text-gray-600 animate-pulse",children:"â³ VÃ©rification en cours..."})}):a==="error"?e.jsxs("div",{className:"flex flex-col justify-center items-center h-screen text-center p-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-red-600 mb-4",children:"âŒ Attestation introuvable"}),e.jsx("p",{className:"text-gray-700",children:"Veuillez vÃ©rifier le lien ou contacter AMP BENIN."})]}):a==="thanks"?e.jsxs("div",{className:"flex flex-col justify-center items-center h-screen text-center p-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-green-700 mb-4",children:"ğŸ™ Merci pour votre contribution"}),e.jsx("p",{className:"text-gray-700",children:"Votre retour a Ã©tÃ© enregistrÃ©. AMP BENIN vous remercie."})]}):e.jsx("div",{className:"min-h-screen flex flex-col justify-center items-center p-6 bg-gradient-to-b from-green-50 to-green-100",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-2xl p-8 w-full max-w-lg text-center",children:[a==="showData"&&r&&e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-green-700 mb-6",children:"âœ… Attestation authentique"}),e.jsxs("div",{className:"space-y-3 text-lg text-gray-800 text-left",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Nom :"})," ",r.nom]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"PrÃ©nom :"})," ",r.prenom]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Mission :"})," ",r.mission]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Email :"})," ",r.email]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Date :"})," ",new Date(r.date).toLocaleDateString()]}),r.fileUrl&&e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"PDF :"})," ",e.jsx("a",{href:r.fileUrl,target:"_blank",className:"text-blue-600 underline",children:"TÃ©lÃ©charger"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("p",{className:"text-gray-700 font-medium mb-4",children:"â„¹ï¸ Les informations affichÃ©es correspondent-elles Ã  celles inscrites sur lâ€™attestation papier ?"}),e.jsxs("div",{className:"flex justify-center gap-4 flex-wrap",children:[e.jsx("button",{onClick:()=>{console.log("âœ… Confirmation reÃ§ue, passage Ã  'thanks'"),o("thanks")},className:"px-6 py-2 bg-green-600 text-white rounded-xl hover:bg-green-700 transition",children:"âœ… Oui"}),e.jsx("button",{onClick:()=>{console.log("ğŸš¨ Signalement demandÃ©, passage Ã  'report'"),o("report")},className:"px-6 py-2 bg-red-600 text-white rounded-xl hover:bg-red-700 transition",children:"âŒ Non"})]})]})]}),a==="report"&&e.jsxs("form",{onSubmit:m,className:"text-left space-y-4",children:[e.jsx("h2",{className:"text-xl font-bold text-red-600 mb-2",children:"ğŸš¨ DÃ©nonciation"}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Merci de nous signaler si vous constatez une fraude. Vous pouvez rester anonyme."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"anonymous",checked:s.anonymous,onChange:t=>{console.log("ğŸ”„ Toggle anonymat :",t.target.checked),c({...s,anonymous:t.target.checked})}}),e.jsx("label",{htmlFor:"anonymous",className:"text-sm text-gray-700",children:"DÃ©nonciation anonyme"})]}),!s.anonymous&&e.jsx("input",{type:"text",placeholder:"Votre nom complet",className:"w-full border rounded-lg p-2",value:s.name,onChange:t=>{console.log("âœï¸ Nom du rapporteur :",t.target.value),c({...s,name:t.target.value})},required:!0}),e.jsx("textarea",{placeholder:"Expliquez votre constat...",className:"w-full border rounded-lg p-2",rows:4,value:s.message,onChange:t=>{console.log("âœï¸ Message du rapport :",t.target.value),c({...s,message:t.target.value})},required:!0}),e.jsx("button",{type:"submit",className:"w-full py-2 bg-red-600 text-white rounded-xl hover:bg-red-700 transition",children:"ğŸš€ Envoyer la dÃ©nonciation"})]})]})})}export{p as default};
