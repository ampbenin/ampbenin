import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as i}from"./index.CRdpAhVf.js";function p({id:n}){const[r,d]=i.useState(null),[a,o]=i.useState("loading"),[s,c]=i.useState({anonymous:!0,name:"",message:""});i.useEffect(()=>{if(!n){console.warn("⚠️ Aucun ID fourni au composant VerifyAttestation");return}console.log("📡 Vérification en cours pour l'ID :",n),fetch(`https://outdoor-arlene-ampbenin-4ca9a164.koyeb.app/api/certificates/verify/${n}`).then(t=>(console.log("📥 Réponse brute du serveur :",t),t.json())).then(t=>{console.log("📥 Réponse JSON décodée :",t),t.error?(console.error("❌ Erreur renvoyée par le backend :",t.error),o("error")):(console.log("✅ Données de l’attestation :",t),d(t),o("showData"))}).catch(t=>{console.error("🚨 Erreur lors du fetch :",t),o("error")})},[n]);const m=async t=>{t.preventDefault(),console.log("📤 Envoi du rapport :",{attestationId:n,...s});try{const l=await fetch("/.netlify/functions/reportAttestation",{method:"POST",body:JSON.stringify({attestationId:n,...s}),headers:{"Content-Type":"application/json"}});if(console.log("📥 Réponse à la dénonciation :",l),!l.ok)throw new Error("Erreur côté serveur");o("thanks")}catch(l){console.error("🚨 Erreur lors de l'envoi de la dénonciation :",l),alert("Erreur lors de l'envoi, veuillez réessayer.")}};return a==="loading"?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("p",{className:"text-gray-600 animate-pulse",children:"⏳ Vérification en cours..."})}):a==="error"?e.jsxs("div",{className:"flex flex-col justify-center items-center h-screen text-center p-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-red-600 mb-4",children:"❌ Attestation introuvable"}),e.jsx("p",{className:"text-gray-700",children:"Veuillez vérifier le lien ou contacter AMP BENIN."})]}):a==="thanks"?e.jsxs("div",{className:"flex flex-col justify-center items-center h-screen text-center p-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-green-700 mb-4",children:"🙏 Merci pour votre contribution"}),e.jsx("p",{className:"text-gray-700",children:"Votre retour a été enregistré. AMP BENIN vous remercie."})]}):e.jsx("div",{className:"min-h-screen flex flex-col justify-center items-center p-6 bg-gradient-to-b from-green-50 to-green-100",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-2xl p-8 w-full max-w-lg text-center",children:[a==="showData"&&r&&e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-green-700 mb-6",children:"✅ Attestation authentique"}),e.jsxs("div",{className:"space-y-3 text-lg text-gray-800 text-left",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Nom :"})," ",r.nom]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Prénom :"})," ",r.prenom]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Mission :"})," ",r.mission]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Email :"})," ",r.email]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Date :"})," ",new Date(r.date).toLocaleDateString()]}),r.fileUrl&&e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"PDF :"})," ",e.jsx("a",{href:r.fileUrl,target:"_blank",className:"text-blue-600 underline",children:"Télécharger"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("p",{className:"text-gray-700 font-medium mb-4",children:"ℹ️ Les informations affichées correspondent-elles à celles inscrites sur l’attestation papier ?"}),e.jsxs("div",{className:"flex justify-center gap-4 flex-wrap",children:[e.jsx("button",{onClick:()=>{console.log("✅ Confirmation reçue, passage à 'thanks'"),o("thanks")},className:"px-6 py-2 bg-green-600 text-white rounded-xl hover:bg-green-700 transition",children:"✅ Oui"}),e.jsx("button",{onClick:()=>{console.log("🚨 Signalement demandé, passage à 'report'"),o("report")},className:"px-6 py-2 bg-red-600 text-white rounded-xl hover:bg-red-700 transition",children:"❌ Non"})]})]})]}),a==="report"&&e.jsxs("form",{onSubmit:m,className:"text-left space-y-4",children:[e.jsx("h2",{className:"text-xl font-bold text-red-600 mb-2",children:"🚨 Dénonciation"}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:"Merci de nous signaler si vous constatez une fraude. Vous pouvez rester anonyme."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"anonymous",checked:s.anonymous,onChange:t=>{console.log("🔄 Toggle anonymat :",t.target.checked),c({...s,anonymous:t.target.checked})}}),e.jsx("label",{htmlFor:"anonymous",className:"text-sm text-gray-700",children:"Dénonciation anonyme"})]}),!s.anonymous&&e.jsx("input",{type:"text",placeholder:"Votre nom complet",className:"w-full border rounded-lg p-2",value:s.name,onChange:t=>{console.log("✍️ Nom du rapporteur :",t.target.value),c({...s,name:t.target.value})},required:!0}),e.jsx("textarea",{placeholder:"Expliquez votre constat...",className:"w-full border rounded-lg p-2",rows:4,value:s.message,onChange:t=>{console.log("✍️ Message du rapport :",t.target.value),c({...s,message:t.target.value})},required:!0}),e.jsx("button",{type:"submit",className:"w-full py-2 bg-red-600 text-white rounded-xl hover:bg-red-700 transition",children:"🚀 Envoyer la dénonciation"})]})]})})}export{p as default};
