import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{r}from"./index.TsWlFSkA.js";function N(){const[n,h]=r.useState(""),[l,v]=r.useState("Tous les volontaires"),[i,p]=r.useState(""),[c,g]=r.useState([]),[f,o]=r.useState(""),[u,d]=r.useState(!1),m=async()=>{if(!n){o("Veuillez renseigner le titre de la mission.");return}d(!0),o("");try{const e={titre:n};l==="Un volontaire"&&i&&(e.email=i),console.log("ðŸ‘‰ [FRONT] Payload envoyÃ© fetchVolunteers:",e);const a=await fetch("https://potential-rafa-amp1-00541efa.koyeb.app/api/certificates/fetch-volunteers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});console.log("ðŸ‘‰ [FRONT] Status rÃ©ponse fetchVolunteers:",a.status);const s=await a.json();if(console.log("ðŸ‘‰ [FRONT] RÃ©ponse backend fetchVolunteers:",s),!a.ok)throw new Error(s.message||"Erreur serveur");s.volunteers&&s.volunteers.length>0?(g(s.volunteers),o(`Volontaires prÃªts Ã  gÃ©nÃ©rer attestation : ${s.volunteers.length}. Mission: ${n}`)):(g([]),o("Aucun volontaire trouvÃ© avec le statut 'Mission validÃ©e' et sans attestation."))}catch(e){console.error("âŒ [FRONT] Erreur handleFetchVolunteers:",e),o(e.message||"Erreur lors de la rÃ©cupÃ©ration des volontaires.")}finally{d(!1)}},b=async()=>{if(c.length===0){o("Aucun volontaire Ã  traiter.");return}d(!0),o("");try{const e={titre:n,mode:l,email:l==="Un volontaire"?i:void 0,volunteers:c};console.log("ðŸ‘‰ [FRONT] Payload envoyÃ© generateCertificate:",e);const a=await fetch("https://potential-rafa-amp1-00541efa.koyeb.app/api/certificates/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});console.log("ðŸ‘‰ [FRONT] Status rÃ©ponse generateCertificate:",a.status);const s=await a.json();if(console.log("ðŸ‘‰ [FRONT] RÃ©ponse backend generateCertificate:",s),!a.ok)throw new Error(s.message||"Erreur serveur");o(`Attestations gÃ©nÃ©rÃ©es avec succÃ¨s pour ${s.generated} volontaire(s).`),g([]),p(""),h("")}catch(e){console.error("âŒ [FRONT] Erreur handleGenerateCertificates:",e),o(e.message||"Erreur lors de la gÃ©nÃ©ration des attestations.")}finally{d(!1)}};return t.jsxs("div",{className:"max-w-xl p-4 rounded-xl shadow-md bg-white",children:[t.jsx("h2",{className:"text-lg font-bold mb-4",children:"GÃ©nÃ©rer les attestations"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("input",{type:"text",placeholder:"Titre de la mission",className:"w-full p-2 border rounded-lg",value:n,onChange:e=>h(e.target.value),required:!0}),t.jsxs("select",{value:l,onChange:e=>v(e.target.value),className:"w-full p-2 border rounded-lg",children:[t.jsx("option",{value:"Tous les volontaires",children:"Tous les volontaires (Mission validÃ©e)"}),t.jsx("option",{value:"Un volontaire",children:"Un volontaire"})]}),l==="Un volontaire"&&t.jsx("input",{type:"email",placeholder:"Email du volontaire",value:i,onChange:e=>p(e.target.value),className:"w-full p-2 border rounded-lg",required:!0}),t.jsx("button",{onClick:m,disabled:u,className:"w-full bg-blue-600 text-white font-semibold py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50",children:u?"Chargement...":"Suivant"}),c.length>0&&t.jsx("button",{onClick:b,disabled:u,className:"w-full bg-green-600 text-white font-semibold py-2 rounded-lg hover:bg-green-700 disabled:opacity-50 mt-2",children:u?"GÃ©nÃ©ration...":"GÃ©nÃ©rer les attestations"}),f&&t.jsx("div",{className:`mt-3 text-sm font-medium ${c.length>0?"text-green-600":"text-red-600"}`,children:f})]})]})}export{N as default};
