---
// Composant : NewsletterSection.astro
---

<section class="py-24 bg-gradient-to-t from-black via-purple-900 to-purple-700 text-white">
  <div class="max-w-5xl mx-auto px-6 text-center">
    <h2 class="text-4xl md:text-5xl font-extrabold mb-6 uppercase tracking-wide">
      Restez Inform√© Pendant les 16 Jours
    </h2>
    <p class="text-lg text-gray-200 max-w-3xl mx-auto mb-10">
      Recevez chaque jour des ressources, √©v√©nements, chiffres cl√©s, t√©moignages et actions √† poser pour lutter contre les violences bas√©es sur le genre.
    </p>

    <!-- Formulaire Newsletter -->
    <form id="newsletterForm" class="bg-white/10 backdrop-blur-md p-8 rounded-2xl shadow-xl border border-purple-500/20 max-w-2xl mx-auto space-y-6">
      <div>
        <label class="block text-left text-sm font-medium mb-2">Nom complet</label>
        <input 
          type="text" 
          name="fullname"
          required
          class="w-full px-4 py-3 rounded-lg bg-white/20 placeholder-gray-300 text-white focus:outline-none focus:ring-2 focus:ring-purple-400"
          placeholder="Votre nom"
        />
      </div>

      <div>
        <label class="block text-left text-sm font-medium mb-2">Adresse email</label>
        <input 
          type="email" 
          name="email"
          required
          class="w-full px-4 py-3 rounded-lg bg-white/20 placeholder-gray-300 text-white focus:outline-none focus:ring-2 focus:ring-purple-400"
          placeholder="exemple@gmail.com"
        />
      </div>

      <div>
        <label class="block text-left text-sm font-medium mb-2">Type d‚Äôalertes souhait√©es</label>
        <select
          name="alert_type"
          class="w-full px-4 py-3 rounded-lg bg-white/20 text-white focus:outline-none focus:ring-2 focus:ring-purple-400"
        >
          <option value="journalier" class="text-black">R√©sum√© quotidien des 16 Jours</option>
          <option value="evenements" class="text-black">Alertes d‚Äô√©v√©nements et ateliers</option>
          <option value="ressources" class="text-black">Nouvelles ressources & outils p√©dagogiques</option>
          <option value="partenaires" class="text-black">Informations partenaires & institutions</option>
        </select>
      </div>

      <button 
        type="submit"
        id="newsletterSubmit"
        class="w-full py-3 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-lg transition duration-300 shadow-lg flex justify-center items-center gap-2"
      >
        S'inscrire maintenant
      </button>
    </form>

    <p id="newsletterMessage" class="text-sm mt-6 transition-all duration-300"></p>
  </div>
</section>

<script type="module">
  const form = document.getElementById("newsletterForm");
  const message = document.getElementById("newsletterMessage");
  const submitButton = document.getElementById("newsletterSubmit");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    message.textContent = "";
    
    // ‚ö° Indicateur de chargement
    submitButton.disabled = true;
    const originalText = submitButton.textContent;
    submitButton.textContent = "Envoi‚Ä¶";

    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());

    try {
      const response = await fetch("https://potential-rafa-amp1-00541efa.koyeb.app/api/newsletter", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });

      const result = await response.json();

      if (response.ok) {
        message.textContent = result.message;
        message.className = "text-green-400 text-lg font-semibold mt-6";
        form.reset();
      } else {
        message.textContent = result.message || "Erreur lors de l'inscription.";
        message.className = "text-red-400 text-lg font-semibold mt-6";
      }
    } catch (error) {
      console.error(error);
      message.textContent = "Erreur serveur, veuillez r√©essayer plus tard.";
      message.className = "text-red-400 text-lg font-semibold mt-6";
    } finally {
      // üîÑ R√©activer le bouton
      submitButton.disabled = false;
      submitButton.textContent = originalText;
    }
  });
</script>
