---
import Layout from "../layouts/BaseLayout.astro";
---

<Layout title="Devenir Volontaire - AMP BENIN">
  <section class="min-h-screen flex items-center justify-center bg-gradient-to-br from-green-50 to-green-100 p-6">
    <div class="bg-white rounded-3xl shadow-2xl max-w-xl w-full p-8 animate-fade-in">
      
      <h1 class="text-4xl font-extrabold text-green-700 mb-4 text-center">
        Rejoignez-nous en tant que Volontaire
      </h1>
      <p class="text-center text-gray-600 mb-8">
        Remplissez ce formulaire pour contribuer activement aux projets AMP BENIN. Chaque geste compte !
      </p>

      <form id="volunteerForm" class="space-y-5">

        <!-- Nom et Pr√©nom -->
        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700">Nom et Pr√©nom</label>
          <input type="text" name="fullName" placeholder="Ex: Jean Dupont" required
            class="mt-1 block w-full p-3 border border-gray-300 rounded-xl focus:ring-green-500 focus:border-green-500 transition" />
        </div>

        <!-- Date de naissance -->
        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700">Date de naissance</label>
          <input type="date" name="birthDate" required
            class="mt-1 block w-full p-3 border border-gray-300 rounded-xl focus:ring-green-500 focus:border-green-500 transition" />
        </div>

        <!-- Genre -->
        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700">Genre</label>
          <select id="genderSelect" name="gender" required
            class="mt-1 block w-full p-3 border border-gray-300 rounded-xl focus:ring-green-500 focus:border-green-500 transition">
            <option value="">Choisissez...</option>
            <option value="H">Homme</option>
            <option value="F">Femme</option>
            <option value="Autre">Autre</option>
          </select>
          <input type="text" id="otherGender" name="otherGender" placeholder="Veuillez pr√©ciser"
            class="mt-2 block w-full p-3 border border-gray-300 rounded-xl focus:ring-green-500 focus:border-green-500 transition hidden" />
        </div>

        <!-- Pays -->
        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700">Pays</label>
          <select id="countrySelect" name="country" required
            class="mt-1 block w-full p-3 border border-gray-300 rounded-xl focus:ring-green-500 focus:border-green-500 transition">
            <option value="">Choisissez un pays</option>
            <option value="B√©nin">B√©nin</option>
            <option value="Togo">Togo</option>
            <option value="Nigeria">Nigeria</option>
            <option value="France">France</option>
            <option value="Autre">Autre</option>
          </select>
          <input type="text" id="otherCountry" name="otherCountry" placeholder="Veuillez pr√©ciser votre pays"
            class="mt-2 block w-full p-3 border border-gray-300 rounded-xl focus:ring-green-500 focus:border-green-500 transition hidden" />
        </div>

        <!-- Ville / Commune -->
        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700">Ville / Commune</label>
          <input type="text" name="city" placeholder="Ex: Cotonou" required
            class="mt-1 block w-full p-3 border border-gray-300 rounded-xl focus:ring-green-500 focus:border-green-500 transition" />
        </div>

        <!-- T√©l√©phone -->
        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700">Num√©ro de t√©l√©phone (WhatsApp)</label>
          <input type="text" name="phone" placeholder="Ex: +229 90 00 00 00" required
            class="mt-1 block w-full p-3 border border-gray-300 rounded-xl focus:ring-green-500 focus:border-green-500 transition" />
        </div>

        <!-- Email -->
        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700">Email</label>
          <input type="email" name="email" placeholder="Ex: email@example.com" required
            class="mt-1 block w-full p-3 border border-gray-300 rounded-xl focus:ring-green-500 focus:border-green-500 transition" />
        </div>

        <!-- Comp√©tence principale -->
        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700">Comp√©tence principale</label>
          <input type="text" name="mainSkill" placeholder="Ex: Communication digitale" required
            class="mt-1 block w-full p-3 border border-gray-300 rounded-xl focus:ring-green-500 focus:border-green-500 transition" />
        </div>

        <!-- Th√©matique sensible -->
        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700">Th√©matique sensible</label>
          <select id="topicSelect" name="sensitiveTopic" required
            class="mt-1 block w-full p-3 border border-gray-300 rounded-xl focus:ring-green-500 focus:border-green-500 transition">
            <option value="">Choisissez...</option>
            <option value="VBG">VBG</option>
            <option value="Environnement">Environnement</option>
            <option value="Sant√©">Sant√©</option>
            <option value="Jeunesse">Jeunesse</option>
            <option value="Num√©rique">Num√©rique</option>
            <option value="Autre">Autre</option>
          </select>
          <input type="text" id="otherTopic" name="otherTopic" placeholder="Veuillez pr√©ciser"
            class="mt-2 block w-full p-3 border border-gray-300 rounded-xl focus:ring-green-500 focus:border-green-500 transition hidden" />
        </div>

        <!-- Domaine souhait√© -->
        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700">Domaine souhait√©</label>
          <select id="domainSelect" name="desiredDomain" required
            class="mt-1 block w-full p-3 border border-gray-300 rounded-xl focus:ring-green-500 focus:border-green-500 transition">
            <option value="">Choisissez...</option>
            <option value="Sensibilisation">Sensibilisation</option>
            <option value="Communication">Communication</option>
            <option value="Logistique">Logistique</option>
            <option value="√âv√©nementiel">√âv√©nementiel</option>
            <option value="Autres">Autres</option>
          </select>
          <input type="text" id="otherDomain" name="otherDomain" placeholder="Veuillez pr√©ciser"
            class="mt-2 block w-full p-3 border border-gray-300 rounded-xl focus:ring-green-500 focus:border-green-500 transition hidden" />
        </div>

        <!-- Motivation -->
        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700">Pourquoi souhaitez-vous devenir volontaire ?</label>
          <textarea name="motivation" rows="4" placeholder="Votre motivation..." required
            class="mt-1 block w-full p-3 border border-gray-300 rounded-xl focus:ring-green-500 focus:border-green-500 transition"></textarea>
        </div>

        <!-- Disponibilit√© -->
        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700">Disponibilit√©</label>
          <select name="availability" required
            class="mt-1 block w-full p-3 border border-gray-300 rounded-xl focus:ring-green-500 focus:border-green-500 transition">
            <option value="">Choisissez...</option>
            <option value="Semaine">Semaine</option>
            <option value="Week-end">Week-end</option>
            <option value="Occasionnel">Occasionnel</option>
          </select>
        </div>

        <!-- Validation -->
        <div class="flex items-center space-x-2">
          <input type="checkbox" name="agreement" required class="h-4 w-4 text-green-600 rounded border-gray-300 focus:ring-green-500" />
          <label class="text-sm text-gray-700">J‚Äôaccepte de devenir volontaire et je certifie que les informations sont exactes.</label>
        </div>

        <!-- Bouton -->
        <button type="submit"
          class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-4 rounded-xl shadow-md transition-transform transform hover:scale-105">
          Envoyer ma candidature
        </button>

        <p id="formMessage" class="text-center mt-4 text-sm text-gray-600"></p>

      </form>
    </div>
  </section>

  <script>
    // Gestion des champs "Autre"
    const fields = [
      { select: 'genderSelect', input: 'otherGender' },
      { select: 'countrySelect', input: 'otherCountry' },
      { select: 'topicSelect', input: 'otherTopic' },
      { select: 'domainSelect', input: 'otherDomain' },
    ];

    fields.forEach(f => {
      const selectEl = document.getElementById(f.select);
      const inputEl = document.getElementById(f.input);

      selectEl.addEventListener('change', () => {
        if (selectEl.value === 'Autre') {
          inputEl.classList.remove('hidden');
          inputEl.focus();
          inputEl.required = true;
        } else {
          inputEl.classList.add('hidden');
          inputEl.value = '';
          inputEl.required = false;
        }
      });
    });

    // Gestion de l'envoi du formulaire
    const form = document.getElementById('volunteerForm');
    const messageEl = document.getElementById('formMessage');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      messageEl.textContent = "Envoi en cours...";
      messageEl.className = "text-blue-600 text-center";

      const formData = Object.fromEntries(new FormData(form));

      try {
        const res = await fetch("https://potential-rafa-amp1-00541efa.koyeb.app/api/volunteer-form", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(formData)
        });

        const result = await res.json();
        if (result.result === "success") {
          messageEl.textContent = "Merci pour votre inscription en tant que volontaire üôå";
          messageEl.className = "text-green-600 text-center";
          form.reset();
          // Cacher tous les champs "Autre" apr√®s reset
          fields.forEach(f => document.getElementById(f.input).classList.add('hidden'));
        } else {
          messageEl.textContent = "Erreur : " + (result.error || "Veuillez r√©essayer");
          messageEl.className = "text-red-600 text-center";
        }
      } catch (err) {
        messageEl.textContent = "Erreur de connexion au serveur";
        messageEl.className = "text-red-600 text-center";
      }
    });
  </script>
</Layout>
